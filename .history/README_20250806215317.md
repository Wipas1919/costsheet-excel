# Excel Cost Sheet Generator

A professional Python application for generating Excel cost sheets with dynamic data insertion and MinIO cloud storage integration.

## Features

- **Professional Excel Template**: Creates standardized cost sheet templates with proper formatting
- **Dynamic Data Insertion**: Automatically inserts data based on list_id categorization
- **Cloud Storage Integration**: Uploads generated files to MinIO with presigned URL generation
- **Professional Formatting**: Includes borders, fonts, colors, and number formatting
- **Text Wrapping**: Intelligent text wrapping for long type names (15+ characters)
- **Data Categorization**: Groups data by type and component based on list_id structure

## Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd Ec-excel
```

2. Install dependencies:
```bash
pip install -r requirements.txt
```

## Usage

### Basic Usage

```python
from excel import main

# Define your data
columns = ["list_id", "Project name", "Show day", "Place", "Component", "Description", "W", "L", "H", "Unit", "Quantity", "price_per_unit", "total_cost", "remark"]
rows = [
    ["10001", "Project A", "2024-01-15", "Bangkok", "Flooring", "Carpet", "10", "5", "0.1", "m2", "50", "100", "5000", "High quality"],
    ["10002", "Project A", "2024-01-15", "Bangkok", "Main structure", "Wall", "3", "2", "2.5", "m2", "6", "200", "1200", "Standard"]
]

# Generate Excel file
result = main(columns, rows, minio_access_key, minio_secret_key, bucket_name)
print(result["file_url"])  # Download URL
```

### Data Structure

The application expects data with the following structure:

#### Columns
- `list_id`: Unique identifier for categorization (format: XXXYY where XXX=type, YY=component)
- `Project name`: Project identifier
- `Show day`: Exhibition date
- `Place`: Location
- `Component`: Item component name
- `Description`: Item description
- `W`, `L`, `H`: Dimensions (Width, Length, Height)
- `Unit`: Unit of measurement
- `Quantity`: Number of items
- `price_per_unit`: Unit price
- `total_cost`: Total cost for the item
- `remark`: Additional notes

#### Type Categorization
- `100`: Structure
- `101`: Furniture&plant (For rent & buy out)
- `102`: Graphic
- `103`: Electrical

#### Component Categorization
- `01`: Flooring
- `02`: Main structure & decoration

## Template Structure

The generated Excel file includes:

1. **Header Section** (A1:K1): "Cost Sheet" with professional formatting
2. **Project Information** (A3:K7): Date, project name, place, sales, designer
3. **Total Cost Section** (A8:K8): Grand total display
4. **Data Table** (A11:K11+): Dynamic data with proper categorization
5. **Professional Formatting**: Borders, fonts, colors, and number formatting

## MinIO Configuration

The application requires MinIO configuration:

```python
minio_access_key = "your_access_key"
minio_secret_key = "your_secret_key"
bucket_name = "your_bucket_name"
```

### Endpoints
- **Internal**: `http://minio:9000` (for Docker network)
- **Public**: `http://100.81.135.35:9009` (for presigned URLs)

## Dependencies

- `openpyxl>=3.1.0`: Excel file manipulation
- `boto3>=1.26.0`: AWS/MinIO client
- `botocore>=1.29.0`: AWS/MinIO core functionality

## File Output

Generated files are saved with the naming convention:
```
CostSheet-YYYYMMDD-HHMMSS.xlsx
```

## Error Handling

The application includes comprehensive error handling for:
- Missing or invalid data
- Network connectivity issues
- File upload failures
- Data format validation

## Development

### Running Tests
```bash
python excel.py
```

### Code Structure
- `create_cost_sheet_template()`: Creates the Excel template
- `insert_dynamic_data()`: Inserts dynamic data based on logic
- `main()`: Orchestrates the entire process

## License

This project is licensed under the MIT License.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## Support

For issues and questions, please create an issue in the repository. 