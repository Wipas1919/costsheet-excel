# Excel Cost Sheet Generator

A professional Excel cost sheet generator that creates structured cost reports with dynamic data insertion and MinIO cloud storage integration.

## Features

- **Fixed Template Structure**: Pre-defined Excel template with professional formatting
- **Dynamic Data Insertion**: Automatically categorizes and inserts data based on list_id logic
- **Professional Formatting**: Consistent fonts, colors, borders, and alignment
- **Cloud Storage Integration**: Automatic upload to MinIO with presigned URL generation
- **Data Categorization**: Groups data by Type and Component with automatic totals
- **Text Wrapping**: Intelligent text wrapping for long type names (15+ characters)

## Template Structure

The Excel template includes:

### Header Section (A1-K8)
- **A1:K1**: "Cost Sheet" title with Calibri 26pt Bold
- **A2**: "Exhibition Booth" subtitle
- **A3-A7**: Date, Project name, Place, Sales, Designer
- **D3-F7**: Booth, Budget, Date of cost, Estimate By, Note
- **G3**: "Decoration" (fixed)
- **G5**: Current date (auto-generated)
- **G7**: "This price is an estimate" (fixed)
- **A8**: "Total cost" with black background

### Data Section (A11-K*)
- **A11-K11**: Table headers (Type, Component, Descriptions, W, L, H, quantity, Unit, Unit Price, Amounts, Remarks)
- **A12+**: Dynamic data insertion with automatic categorization

## Data Logic

### Type Categorization (list_id first 3 digits)
- `100` → Structure
- `101` → Furniture&plant (For rent & buy out)
- `102` → Graphic
- `103` → Electrical

### Component Grouping (list_id middle 2 digits)
- `01` → Flooring
- `02` → Main structure & decoration

### Display Order
1. Structure
2. Furniture&plant (For rent & buy out)
3. Graphic
4. Electrical

## Installation

### Prerequisites
- Python 3.11+
- MinIO server access

### Dependencies
```bash
pip install -r requirements.txt
```

### Required Packages
```
openpyxl>=3.1.0
boto3>=1.26.0
botocore>=1.29.0
```

## Usage

### Basic Usage
```python
from excel import main

# Define your data
columns = ["list_id", "Project name", "Show day", "Place", "Component", "Description", 
           "W", "L", "H", "Unit", "Quantity", "price_per_unit", "total_cost", "remark"]
rows = [
    ["10001", "Project A", "2024-01-15", "Bangkok", "Flooring", "Carpet", 
     "10", "5", "0.1", "m2", "50", "100", "5000", "High quality"],
    ["10002", "Project A", "2024-01-15", "Bangkok", "Main structure", "Wall", 
     "3", "2", "2.5", "m2", "6", "200", "1200", "Standard"]
]

# Generate Excel file
result = main(columns, rows, minio_access_key, minio_secret_key, bucket_name)
print(result["file_url"])  # Download URL
```

### Dify Integration
```python
# In Dify workflow
def process_cost_sheet(columns, rows, minio_access_key, minio_secret_key, bucket_name):
    return main(columns, rows, minio_access_key, minio_secret_key, bucket_name)
```

## Configuration

### MinIO Settings
- **Internal Endpoint**: `http://minio:9000` (Docker network)
- **Public Endpoint**: `http://100.81.135.35:9009` (External access)
- **File Naming**: `CostSheet-YYYYMMDD-HHMMSS.xlsx`
- **Storage Path**: `excel-sheet/` bucket folder

### Column Requirements
Required columns in your data:
- `list_id`: Unique identifier for categorization
- `Project name`: Project name (inserted into B4)
- `Show day`: Event date (inserted into B3)
- `Place`: Location (inserted into B5)
- `Component`: Component name
- `Description`: Item description
- `W`, `L`, `H`: Dimensions
- `Unit`: Unit of measurement
- `Quantity`: Quantity
- `price_per_unit`: Unit price
- `total_cost`: Total cost (used for calculations)
- `remark`: Additional remarks

## Output Format

The generated Excel file includes:
- Professional formatting with Calibri font
- Automatic borders and alignment
- Number formatting with comma separators
- Gray background for TOTAL rows
- Black background for grand total
- Text wrapping for long type names
- Presigned URL for easy sharing

## Error Handling

The system includes comprehensive error handling for:
- Missing required columns
- Invalid data formats
- Network connectivity issues
- File upload failures

## Development

### Project Structure
```
Ec-excel/
├── excel.py          # Main Excel generation logic
├── requirements.txt  # Python dependencies
└── README.md        # This documentation
```

### Key Functions
- `create_cost_sheet_template()`: Creates the base Excel template
- `insert_dynamic_data()`: Inserts and categorizes dynamic data
- `main()`: Orchestrates the entire process

## License

This project is designed for internal use and cost sheet generation workflows.

## Support

For technical support or feature requests, please refer to the project documentation or contact the development team. 